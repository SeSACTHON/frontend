#!/bin/bash
set -e

# 현재 브랜치명 가져오기
BRANCH_NAME=$(git symbolic-ref --short HEAD)

# 브랜치 prefix → 커밋 prefix 매핑
case "$BRANCH_NAME" in
  feat/*) PREFIX="[feat]" ;;
  fix/*) PREFIX="[fix]" ;;
  refactor/*) PREFIX="[refactor]" ;;
  style/*) PREFIX="[style]" ;;
  chore/*) PREFIX="[chore]" ;;
  *) PREFIX="" ;;
esac

# 커밋 메시지 파일 경로 ($1은 git이 자동으로 전달)
COMMIT_MSG_FILE="$1"

# 파일에 prefix 추가
if [ -n "$PREFIX" ]; then
  # 파일이 비어있으면 prefix만 작성
  if [ ! -s "$COMMIT_MSG_FILE" ]; then
    echo "$PREFIX " > "$COMMIT_MSG_FILE"
  else
    # 첫 줄 맨 앞에 prefix 추가
    sed -i "1s/^/$PREFIX /" "$COMMIT_MSG_FILE"
  fi
  echo "✅ 커밋 템플릿 적용 완료: $PREFIX"
else
  echo "⚠️ 브랜치 prefix를 인식하지 못했습니다. (현재 브랜치: $BRANCH_NAME)"
fi
