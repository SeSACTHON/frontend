#!/bin/bash
set -e

BRANCH_NAME=$(git symbolic-ref --short HEAD)

# 브랜치 prefix → 커밋 prefix 매핑
case "$BRANCH_NAME" in
  feat/*) PREFIX="[feat]" ;;
  fix/*) PREFIX="[fix]" ;;
  refactor/*) PREFIX="[refactor]" ;;
  style/*) PREFIX="[style]" ;;
  chore/*) PREFIX="[chore]" ;;
  *) PREFIX="" ;;
esac

COMMIT_MSG_FILE="$1"

if [ -n "$PREFIX" ]; then
  # 파일 내용 읽기 (없으면 빈 문자열)
  if [ -s "$COMMIT_MSG_FILE" ]; then
    CONTENTS=$(cat "$COMMIT_MSG_FILE")
  else
    CONTENTS=""
  fi

  # 이미 prefix가 포함되어 있으면 중복 추가 방지
  if [[ "$CONTENTS" == "$PREFIX"* ]]; then
    echo "⚙️ 이미 prefix가 포함되어 있어 추가하지 않음: $PREFIX"
    exit 0
  fi

  # prefix + 기존 내용 다시 작성
  {
    echo "$PREFIX "
    echo "$CONTENTS"
  } > "$COMMIT_MSG_FILE"

  echo "✅ 커밋 템플릿 적용 완료: $PREFIX"
else
  echo "⚠️ 브랜치 prefix를 인식하지 못했습니다. (현재 브랜치: $BRANCH_NAME)"
fi
